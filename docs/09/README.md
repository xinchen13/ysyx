# 运行时环境和基础设施
- 为了运行更多的程序, 要为npc添加更多的指令, 进而考虑应该如何编译一个可以在npc上运行的程序, 并将其放到npc上运行
- 了解程序和计算机硬件之间的一层重要的抽象: 运行时环境
- 搭建更强大的基础设施, 在后续设计npc的时候发挥作用

## 运行时环境
应用程序的运行都需要运行时环境的支持, 包括加载, 销毁程序, 以及提供程序运行时的各种动态链接库(而不只单单会计算的TRM)

### 将运行时环境封装成库函数
- 为了让`n`个程序运行在`m`个架构上，本需要维护`n*m`份代码
- 通过把运行时环境抽象成库, 只需要定义一个结束程序的API, 比如`void halt()`供软件调用, 不同的架构分别实现自己的`halt()`, 这样就只需要维护`n+m`份代码

## AM - 裸机(bare-metal)运行时环境
AM(Abstract machine): 一个向程序提供运行时环境的库, 包含一组统一抽象的API, AM根据程序的需求把库划分成以下模块: AM = TRM + IOE + CTE + VME + MPE
- TRM(Turing Machine) - 图灵机, 最简单的运行时环境, 为程序提供基本的计算能力
- IOE(I/O Extension) - 输入输出扩展, 为程序提供输出输入的能力
- CTE(Context Extension) - 上下文扩展, 为程序提供上下文管理的能力
- VME(Virtual Memory Extension) - 虚存扩展, 为程序提供虚存管理的能力
- MPE(Multi-Processor Extension) - 多处理器扩展, 为程序提供多处理器通信的能力

有了AM后, PA的流程:
```
(在NEMU中)实现硬件功能 -> (在AM中)提供运行时环境 -> (在APP层)运行程序
(在NEMU中)实现更强大的硬件功能 -> (在AM中)提供更丰富的运行时环境 -> (在APP层)运行更复杂的程序
```

### 操作系统也有自己的运行时环境. AM和操作系统提供的运行时环境有什么不同呢? 为什么会有这些不同
AM提供的是程序运行必不可少的API，是OS提供的接口的子集